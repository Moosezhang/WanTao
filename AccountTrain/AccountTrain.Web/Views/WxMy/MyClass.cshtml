
@{
     ViewBag.Title = "我的课程";
}


<style>
.am-btn-this
{
	display:inline-block;
	margin-bottom:0;
	/*padding:.5em 1em;*/
	vertical-align:middle;
	font-size:0.6rem;
	font-weight:400;
	text-align:center;
	white-space:nowrap;
	background-image:none;
	border:1px solid transparent;
	border-radius:0;
	cursor:pointer;
	outline:0;
	-webkit-appearance:none;
	-webkit-user-select:none;
	-moz-user-select:none;
	-ms-user-select:none;
	user-select:none;
	-webkit-transition:background-color .3s ease-out,border-color .3s ease-out;transition:background-color .3s ease-out,border-color .3s ease-out;
}
</style>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>我的课程</title>
</head>
<body>
  	<header data-am-widget="header" class="am-header am-header-default" style="background-color: white;">
	  <div class="am-header-left am-header-nav">
		    <a href="javascript:window.history.back(); " class="">
		  	<img class="am-header-icon-custom" src="~/Images/icon/返回.png" alt=""/>
		  </a>
	  </div>
	   <h3 class="am-header-title" 
	   	style="width:150px;float:left;color: black;padding-top: 15px;font-size: 18px;margin-right: 0px;">
          	我的课程
      </h3>
      <div class="am-input-group">	
	      <span class="am-input-group-btn" >
	      	<button class="am-btn" type="button" onclick="GoHome()" 
	        	style="background-color: white;border-color:white;margin-left: 45px;">
	        	<div><img class="am-header-icon-custom" src="~/Images/icon/主页.png" style="height: 20px;" alt=""/></div>
	        </button>
	        
	      </span>
	    </div>
	</header>
  	<hr style="margin-top: 0px;"/>
  	<div id="myClass">
  		<div class="am-u-lg-6">
	    	<div class="am-input-group" >
	    	  <div style="float: left;width: 35%;margin-top: 10px;">您共有<span style="color: red;">{{classCount}}</span>门课程</div>	
		      <input type="text" v-model="txtTitle" class="am-form-field" 
		      	style="border-top-left-radius:5px;border-bottom-left-radius:5px;float:right;width: 65%;" placeholder="输入要找的职位">
			      <span class="am-input-group-btn" >
			        <button class="am-btn am-btn-default" type="button" v-on:click="Query()" style="border-top-right-radius:5px;border-bottom-right-radius:5px;"><span class="am-icon-search"></span> </button>
			      </span>
		    </div>
	  	</div>  	
	  	<hr style="margin-top: 0px;"/>
        <div data-am-widget="list_news" class="am-list-news am-list-news-default" style="margin-top:50px;margin-left:0px;margin-right:0px;">		
			  <div class="am-list-news-bd">
				  <ul class="am-list" v-for="item in myClassList">
				     <!--缩略图在标题左边-->
				      <li class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left" 
				      	style="padding-top: 5px;padding-bottom: 5px;background-color: #F5F5F5;">
				        <div class="am-u-sm-4 am-list-thumb" style="width: 30%;height: 60px;padding-right: 0px;">
				        	<img :src="item.ClassImages"/>
				        </div>
						<table class=" am-u-sm-8 am-list-main" style="height: 60px;position:relative;">
							<tr>
								<td >
									<div style="color: #444444;">{{item.ClassName}}</div>									
								</td>
								<td>
									<div style="color: #999999;margin-right: 10px;float: right;">¥{{item.ClassPrice}}</div>
								</td>
							</tr>
							<tr>
								<td>
									<div style="font-size: 5px;"><b>{{item.ClassTeacher}}</b></div>
								</td>
								<td>
									<div v-if="item.OrderStatus==1">
										<button class="am-btn-this am-btn-default" type="button" v-on:click="GoPay(item.ClassId,item.ClassPrice)" style="border-radius:60px;color: red;background-color: #FAFAFA;border-color: red;margin-right: 10px;float: right;">去付款</button>
									</div>
									<div v-if="item.OrderStatus==2">
										<button class="am-btn-this am-btn-default" type="button" v-on:click="GoStudy(item.ClassId)" style="border-radius:60px;color: #4395ff;background-color: #FAFAFA;border-color: #4395ff;margin-right: 10px;float: right;">去学习</button>
									</div>
								</td>
							</tr>
						</table>				        
				      </li>  
				    </ul>
			  </div>
		</div>
  	</div>
  	
</body>


<script>
	var openid = '@ViewBag.Openid';
	var myClassVue=new Vue({
		el:"#myClass",
		data:{
			myClassList:[],
			txtTitle:"",
			classCount:0,
			orderNo:""
		},
		created: function () {
                this.Query()
         },
         methods:{
         	Query:function () {  
			    var _self = this;
                var title = this.txtTitle;
                $.ajax({
                    type: "get",
                    dataType: "json",
                    contentType: "application/json",
                    url: "/WxMy/GetMyClassByopenId?pGuid=" + guid(),
                    data: {
                        openid:openid,
                        title:title
                    },
                    success: function (result) {                       
                        _self.myClassList = result;
                        _self.classCount=result.length;
                    },
                    error: function (json) {
                        _self.$message.error('查询失败');
                    }
                });
			},
			GoPay:function(classId,price){
				var _self = this;	
				var param={
					classids:"",
					openid:openid,
					source:"1",
					price:price
				}
				
				param.classids=classId+"|";
				
				$.ajax({
                    type: "post",
                    dataType: "json",
                    url: "/WxOrder/AddOrder?pGuid=" + guid(),
                    data:param,
                    success: function (result) {
                    	_self.orderNo=result;
                    },
                    error: function (json) {
                        
                    }
                });
				window.location.href = "/WxOrder/Index?openid=" + openid+"&&orderNo="+_self.orderNo;
			},
			GoStudy:function(classId){				
				window.location.href = "/WxClass/ClassDetail?openid=" + openid+"&&classId="+classId;
			}
         }
	});
	
	 function guid() {
        function S4() {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return (S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4());
    }
	 
	  
	 function GoHome()
	 {
	 	window.location.href = "/WxHome/Index?openid="+openid+"&&code=null&&state=null";
	 }
	
</script>
