
@{
     ViewBag.Title = "注册";
}



<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="telephone=no" name="format-detection" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta charset="UTF-8" />
    <title>注册</title>
</head>
<body>
    <div class="content marb60">
    <div class="am-container am-margin-top-lg">
        <div class="am-g">
            <div id="register" class="am-u-sm-12">
                <form class="am-form am-form-horizontal" id="form">    
                    <div class="am-form-group">
                        <div class="am-u-sm-12">
                            <div class="am-form-icon">
                            	<i class="am-icon-mobile-phone"></i>
                                <input type="text" v-model="phone" name="phone" id="phone" class="am-form-field" style="border-radius:5px;height: 45px;" placeholder="手机号">
                            </div>
                        </div>
                    </div>
                    <div class="am-form-group">
                        <div class="am-u-sm-12">
                            <div class="am-form-icon">
                            	<i class="am-icon-lock"></i>
                                <input type="text" v-model="code" name="code" id="code" class="am-form-field" style="border-top-left-radius:5px;border-bottom-left-radius:5px;width: 70%;float:left;height: 45px;" placeholder="验证码">
                                
                                <input id="btnGetSMS" class="am-btn-block am-btn am-btn-primary " v-on:click="btnGetSMS()" type="button" value="短信验证码" style="border-top-right-radius:5px;border-bottom-right-radius:5px;width: 30%;height: 45px;                                	background-color:#f9d001;border-color:#f9d001;color: black;"/>
                            </div>
                        </div>
                    </div>                    
                    <div class="am-form-group am-margin-bottom-sm" style="margin-top: 40px;">
                        <div class="am-u-sm-12">
                            <input type="button" id="btnSubmit" value="注册" v-on:click="btnSubmit()" class="am-btn-block am-btn am-btn-primary " style="border-radius:5px;height: 45px;">
                        </div>
                    </div>
                </form>               
            </div>
        </div>
    </div>  
   
</div>
</body>


<script>
	var openid = '@ViewBag.Openid';
	var registerVue=new Vue({
		el:"#register",
		data:{
			phone:"",
			code:"",
			openid:"",
		},
		methods:{
			btnGetSMS:function(){
				var _self = this;
				var phone = this.phone;
				if(!(/^1(3|4|5|7|8)\d{9}$/.test(phone))){ 
					//$('#phone-alert').modal();
					_self.$message.error('请输入有效的手机号');
                return;
	           }
				
				$.ajax({
                        type: "get",
                        dataType: "json",
                        contentType: "application/json",
                        url: "/WxMy/getValidSMS?pGuid=" + guid(),
                        data: {
                            strTel: phone
                        },
                        success: function (result) {
                        	if(result=="Success")
                        	{
                        		_self.$message({
                                    type: 'success',
                                    message: '请注意查收验证码!'
                                });
                        	}
                        	else
                        	{
                        		_self.$message.error(result);
                        	}
                        	
                        },
                        error: function (json) {
                            _self.$message.error('系统异常，请稍后再试');
                        }
                    });	
				
			},
			btnSubmit:function(){
				var phone = this.phone;
                var code = this.code;
                var _self = this;
                $.ajax({
                    type: "post",
                    dataType: "json",
                    url: "/WxMy/Register",
                    data:{
                    	openid:openid,
                    	phone:phone,
                    	code:code
                    },
                    success: function (result) {
                        if (result=="Success") {                            
                            _self.$message({
                                type: 'success',
                                message: '注册成功!'
                            });
                            window.location.href = "/WxHome/Index?openid="+openid+"&&code=null&&state=null";
                        } else {
                            _self.$message.error(result);
                        }
                    },
                    error: function (json) {
                        _self.$message.error('注册失败');
                    }
                });
			}
		}
	});
	
	 function guid() {
        function S4() {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return (S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4());
    }
	
</script>
